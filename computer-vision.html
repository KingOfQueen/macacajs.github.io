<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="renderer" content="webkit" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <meta name="format-detection" content="telephone=no, email=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="generator" content="Jekyll v3.7.3" />
    <meta name="description" content="" />
    <title>Macaca • Solution for Automation Test with Ease</title>
    <link rel="canonical" href="https://macacajs.github.io" />
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="/assets/css/styles.css" />
    <script src="/assets/polymer/webcomponents-lite.min.js"></script>
    <link rel="import" href="/assets/polymer/paper-ripple.html" />
    <base target="_blank" />
  </head>
  <body data-page="/computer-vision">
    <input type="hidden" id="lang" value="en"/>

    <header class="clearfix">
  <div class="container">
    <a target="_self" href="/" class="brand">Macaca</a>
    <nav id="nav">
      <a href="/" target="_self">
        <paper-ripple class="peach"></paper-ripple>
        Home
      </a>
      <a href="/introduction" class="current" target="_self">
        <paper-ripple class="peach"></paper-ripple>
        Document
      </a>
      <a href="/support" target="_self">
        <paper-ripple class="peach"></paper-ripple>
        Support
      </a>
      <a href="//github.com/alibaba/macaca/issues?utf8=%E2%9C%93&q=">
        <svg class="github-icon"
          xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMinYMin meet"
          viewBox="0 0 500 500">
          <path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z">
          </path>
        </svg>
      </a>
      <p class="lang-button" id="lang-button">
        中文
      </p>
    </nav>
    <button id="menu" class="menu"></button>
  </div>
</header>
<script>
  (function() {
    var menu = document.getElementById('menu');
    var nav = document.getElementById('nav');
    var hidden = true;

    menu.addEventListener('click', function() {
      nav.style.display = hidden ? 'block' : 'none';
      hidden = !hidden;
    }, false);
  })();
</script>


    <section class="container">
  
<select class="nav-mobile" onchange="if (this.value) window.location.href=this.value">
  <option value="">Navigate the docs…</option>
  
  <optgroup label="Guides">
    
      <option value="introduction">Introduction</option>
    
      <option value="environment-setup">Environment Setup</option>
    
      <option value="quick-start">Quick Start</option>
    
      <option value="helpful-settings">Helpful Settings</option>
    
      <option value="versioning">Versioning</option>
    
  </optgroup>
  
  <optgroup label="API">
    
      <option value="nodejs">Node.js</option>
    
      <option value="java">Java</option>
    
      <option value="python">Python</option>
    
  </optgroup>
  
  <optgroup label="Advanced">
    
      <option value="debugging">Debugging</option>
    
      <option value="inspector">Inspector</option>
    
      <option value="recorder">Recorder</option>
    
      <option value="datahub">DataHub</option>
    
      <option value="coverage">Coverage</option>
    
      <option value="nosmoke">NoSmoke</option>
    
      <option value="monkey-testing">Monkey Testing</option>
    
      <option value="computer-vision">Computer Vision</option>
    
      <option value="pageuitest">PageUITest</option>
    
      <option value="browser">Browser Testing</option>
    
  </optgroup>
  
  <optgroup label="Continue Integration">
    
      <option value="run-with-scripts">Integration with scripts</option>
    
      <option value="run-with-docker">Run with docker</option>
    
      <option value="master-deployment">Reliable Master</option>
    
      <option value="slave-deployment">Reliable Slave</option>
    
  </optgroup>
  
  <optgroup label="Other">
    
      <option value="roadmap">RoadMap</option>
    
      <option value="contributing">Contributing</option>
    
      <option value="faq">FAQ</option>
    
  </optgroup>
  
</select>

  
<aside id="sidebar">
  
  <h4>Guides</h4>
  <ul>
    
    
    <li><a href="introduction" target="_self">Introduction</a></li>
    
    
    <li><a href="environment-setup" target="_self">Environment Setup</a></li>
    
    
    <li><a href="quick-start" target="_self">Quick Start</a></li>
    
    
    <li><a href="helpful-settings" target="_self">Helpful Settings</a></li>
    
    
    <li><a href="versioning" target="_self">Versioning</a></li>
    
  </ul>
  
  <h4>API</h4>
  <ul>
    
    
    <li><a href="nodejs" target="_self">Node.js</a></li>
    
    
    <li><a href="java" target="_self">Java</a></li>
    
    
    <li><a href="python" target="_self">Python</a></li>
    
  </ul>
  
  <h4>Advanced</h4>
  <ul>
    
    
    <li><a href="debugging" target="_self">Debugging</a></li>
    
    
    <li><a href="inspector" target="_self">Inspector</a></li>
    
    
    <li><a href="recorder" target="_self">Recorder</a></li>
    
    
    <li><a href="datahub" target="_self">DataHub</a></li>
    
    
    <li><a href="coverage" target="_self">Coverage</a></li>
    
    
    <li><a href="nosmoke" target="_self">NoSmoke</a></li>
    
    
    <li><a href="monkey-testing" target="_self">Monkey Testing</a></li>
    
    
    <li class="current"><a href="computer-vision" target="_self">Computer Vision</a></li>
    
    
    <li><a href="pageuitest" target="_self">PageUITest</a></li>
    
    
    <li><a href="browser" target="_self">Browser Testing</a></li>
    
  </ul>
  
  <h4>Continue Integration</h4>
  <ul>
    
    
    <li><a href="run-with-scripts" target="_self">Integration with scripts</a></li>
    
    
    <li><a href="run-with-docker" target="_self">Run with docker</a></li>
    
    
    <li><a href="master-deployment" target="_self">Reliable Master</a></li>
    
    
    <li><a href="slave-deployment" target="_self">Reliable Slave</a></li>
    
  </ul>
  
  <h4>Other</h4>
  <ul>
    
    
    <li><a href="roadmap" target="_self">RoadMap</a></li>
    
    
    <li><a href="contributing" target="_self">Contributing</a></li>
    
    
    <li><a href="faq" target="_self">FAQ</a></li>
    
  </ul>
  
</aside>

  <article>
    <h1 id="computer-vision">Computer Vision</h1>

<p>Macaca provides computer vision solutions to analyze the UI outside the View system, e.g. to identify screenshots during testing, test game products, etc. This document will describe how OpenCV, Sikuli, and other widely used libraries are used in conjunction with Macaca, and introduces the NodeCV service deployment, after which you can use this graphics service anytime, anywhere.</p>

<h2 id="opencv">OpenCV</h2>

<h3 id="installation">Installation</h3>

<p>For MacOS, please use brew to install opencv2:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>brew <span class="nb">install </span>opencv
</code></pre></div></div>

<p>Please use the stable version of <a href="//codeload.github.com/opencv/opencv/zip/2.4.13.2">v2 (2.4.13.2)</a>. For installation on Windows platform, please refer to the <a href="//github.com/opencv/opencv">OpenCV website</a>.</p>

<p>If you do not want to install on your local machine, please use the NodeCV service mentioned later to avoid any problems in the environment.</p>

<h3 id="usage">Usage</h3>

<h4 id="nodejs">Node.js:</h4>

<p>You only need to introduce <a href="https://github.com/xudafeng/nodecv">nodecv</a> module to use the image similarity, feature matching, feature recognition and other functions.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">nodecv</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'nodecv'</span><span class="p">);</span>

<span class="nx">nodecv</span><span class="p">.</span><span class="nx">imread</span><span class="p">(</span><span class="nx">image1Path</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">image1</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">nodecv</span><span class="p">.</span><span class="nx">imread</span><span class="p">(</span><span class="nx">image2Path</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">image2</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">nodecv</span><span class="p">.</span><span class="nx">imageDissimilarity</span><span class="p">(</span><span class="nx">image1</span><span class="p">,</span> <span class="nx">image2</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">dissimilarity</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Dissimilarity: </span><span class="p">${</span><span class="nx">dissimilarity</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Matching method enumeration:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CV_TM_SQDIFF        =0 Square difference matching method
CV_TM_SQDIFF_NORMED =1 Normalized squared difference matching metho
CV_TM_CCORR         =2 Correlation matching method
CV_TM_CCORR_NORMED  =3 Normalized Correlation Matching
CV_TM_CCOEFF        =4 Correlation coefficient matching method
CV_TM_CCOEFF_NORMED =5 Normalized correlation coefficient matching method
</code></pre></div></div>

<p>For more Node.js samples, visit <a href="//github.com/macaca-sample/cv-sample-node">macaca-sample/cv-sample-node</a>。</p>

<h4 id="python">Python:</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="k">class</span> <span class="nc">opencvSample</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourceimage</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourceimage</span> <span class="o">=</span> <span class="n">sourceimage</span>

    <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">templateimage</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">):</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sourceimage</span><span class="p">)</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">templateimage</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">matchTemplate</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">TM_CCOEFF_NORMED</span><span class="p">)</span>
        <span class="n">similarity</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">minMaxLoc</span><span class="p">(</span><span class="n">result</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">similarity</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">similarity</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">argmax</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div></div>

<p>For more Python samples, visit <a href="//github.com/macaca-sample/cv-sample-python">macaca-sample/cv-sample-python</a>。</p>

<h4 id="java">Java:</h4>

<p>For Java, please directly use <a href="//github.com/bytedeco/javacv">JavaCV</a>. For more Java samples, visit <a href="//github.com/macaca-sample/cv-sample-java">macaca-sample/cv-sample-java</a>.</p>

<h3 id="nodecv-as-a-service">NodeCV as a Service</h3>

<p>Macaca provides easy deployment of OpenCV services and requires only a Docker environment for one-click deployment.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git clone https://github.com/macacajs/nodecv-server.git <span class="nt">--depth</span><span class="o">=</span>1
<span class="nv">$ </span><span class="nb">cd </span>nodecv-server
<span class="nv">$ </span>docker build <span class="nb">.</span> <span class="nt">-t</span><span class="o">=</span><span class="s2">"node-server"</span>
</code></pre></div></div>
<p>You can then start OpenCV’s HTTP service in any server environment, or even on a <a href="//github.com/macacajs/nodecv-server/issues/1">Raspberry Pi</a>, and <a href="//github.com/macaca-sample">macaca-sample</a> also provides examples of language-specific server-side communication.</p>

<p>After starting the server, please visit <code class="highlighter-rouge">http://localhost:9900/opencv/demo</code></p>

<p><img src="//wx3.sinaimg.cn/large/6d308bd9gy1fek6oa9i3vj21kw0zrn4y.jpg" alt="" /></p>

<h2 id="api">API</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /opencv/dissimilarity
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /opencv/matchtemplate
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /opencv/cascadedetect
</code></pre></div></div>

<p>HTTP service request example:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">({</span>
  <span class="na">url</span><span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="nx">remoteHost</span><span class="p">}</span><span class="s2">/opencv/dissimilarity`</span><span class="p">,</span>
  <span class="na">formData</span><span class="p">:</span> <span class="nx">formData</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">httpResponse</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'upload failed:'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Server responded with:'</span><span class="p">,</span> <span class="nx">body</span><span class="p">);</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Dissimilarity is: </span><span class="p">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">dissimilarity</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">}</span>
<span class="p">});</span>

</code></pre></div></div>

<p>For more information, visit <a href="//github.com/macacajs/nodecv-server">nodecv-server</a>.</p>

<h2 id="other-solutions">Other Solutions</h2>

<h3 id="sikuli">Sikuli</h3>

<p><a href="//github.com/sikuli/sikuli">Sikuli</a> is a graphics scripting language, and can be used with Macaca to automate graphical user interfaces (GUI) using images (screenshots).</p>

<h3 id="tesseract">Tesseract</h3>

<p><a href="//github.com/tesseract-ocr/tesseract">tesseract</a> excels at OCR, and can be used with OpenCV.</p>

<h3 id="image-diff">Image Diff</h3>

<p>For image diff based on pixel contrast, the following can be used:</p>

<ul>
  <li><a href="//github.com/uber-archive/image-diff">uber-archive/image-diff</a></li>
  <li><a href="//github.com/yahoo/blink-diff">yahoo/blink-diff</a></li>
</ul>

<p>Example usage with Macaca <a href="//github.com/macaca-sample/react-native-sample">macaca-sample/react-native-sample</a>. Effect is as follows</p>

<p><img src="http://ww3.sinaimg.cn/large/6d308bd9gw1f3ymytc3mzj21kw0xpjx1.jpg" alt="" /></p>

<p>The game framework Hilo is also based on pixel comparison. See the example of combining with Macaca. See the <a href="//github.com/hiloteam/Hilo">hiloteam/Hilo</a>.</p>


  </article>
</section>
<script src="/assets/js/smooth-scroll.min.js"></script>
<script src="/assets/js/index.js"></script>


    <footer>
  <p>
    Released under the
    <a href="//github.com/alibaba/macaca/blob/master/LICENSE">MIT License</a>
  </p>
  <p>
    &copy; 2015-2018
    <a href="//github.com/alibaba/macaca">Macaca</a>
  </p>
</footer>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-49226133-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
